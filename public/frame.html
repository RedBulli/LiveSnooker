<!DOCTYPE html>
<html>
<head>
  <script src="vendors/webcomponentsjs/webcomponents.js"></script>
  <link rel="import" href="vendors/app-router/app-router.html">
  <link rel="import" href="elements/management/google-auth.html">
  <link rel="import" href="elements/live-snooker-api.html">
  <link rel="import" href="elements/live-snooker.html">
  <link rel="import" href="elements/js/frame.html">
</head>
<body>
  <template id="auto-bind-demo" is="auto-binding">
    <live-snooker-api id="api" host="<!-- @echo BACKEND_HOST -->"></live-snooker-api>
    <google-auth googleId="<!-- @echo GOOGLE_CLIENT_ID -->"></google-auth>
    <app-router>
      <app-route path="*" element="frame-loader"></app-route>
    </app-router>
  </template>

  <polymer-element name="frame-loader" attributes="frameId">
    <template>
      <live-snooker-api id="api"></live-snooker-api>
      <template if="{{frame}}">
        <live-snooker-frame frame="{{ frame }}"></live-snooker-frame>
      </template>
      <template if="{{!frame}}">
        Loading!
      </template>
    </template>
    <script>
      Polymer('frame-loader', {
        domReady: function() {
          var _this = this;
          var frame = new Frame({id: this.frameId});
          frame.setApiClient(this.$.api);
          frame.fetch({
            success: function() {
              _this.frame = frame;
              frame.get('Shots').populateAssociations();
              frame.calculateShotGroups();
            }
          });
        }
      });
    </script>
  </polymer-element>
</body>
</html>
