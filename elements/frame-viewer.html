<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="frame-score-view.html">
<link rel="import" href="break-history-view.html">
<link rel="import" href="live-snooker-api.html">
<link rel="import" href="event-stream.html">
<link rel="import" href="p2p-video.html">
<link rel="import" href="frame-novideo-view.html">

<polymer-element name="frame-viewer" attributes="frame video">
  <template>
    <link rel="stylesheet" href="css/foundation.min.css">
    <style>
      #gameview {
        width: 640px;
      }

      #on-video-score {
        position: relative;
        top: -2em;
        text-align: center;
      }
    </style>
    <live-snooker-api id="api" on-api="{{onApiReady}}"></live-snooker-api>
    <template if="{{streamUrl}}">
      <event-stream streamUrl="{{streamUrl}}" on-event="{{onStreamEvent}}"></event-stream>
    </template>
    <div class="row">
      <div class="large-8 columns">
        <div id="gameview">
          <template if="{{video}}">
            <p2p-video leagueId="{{frame.attributes.League.id}}" frameId="{{frame.id}}"></p2p-video>
            <frame-score-view id="on-video-score" state="{{frame.state}}"></frame-score-view>
          </template>
          <template if="{{!video}}">
            <frame-novideo-view model="{{frame}}" state="{{frame.state}}"></frame-novideo-view>
          </template>
        </div>
      </div>
      <div class="large-4 columns">
        <break-history-view class="hidden-for-medium-down" breaks="{{frame.attributes.shotGroups}}"></break-history-view>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      onStreamEvent: function(event) {
        this.frame.newShot(event.detail.shot);
      },
      domReady: function() {
        this.streamUrl = this.$.api.host + "/framestream";
      }
    });
  </script>
</polymer-element>
