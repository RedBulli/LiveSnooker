<link rel="import" href="../../vendors/polymer/polymer.html">
<link rel="import" href="points-input.html">
<link rel="import" href="../../vendors/iron-a11y-keys/iron-a11y-keys.html">

<dom-module id="frame-input">
  <template>
    <iron-a11y-keys target="[[target]]" keys="0" on-keys-pressed="missedKey"></iron-a11y-keys>
    <iron-a11y-keys target="[[target]]" keys="1 2 3 4 5 6 7" on-keys-pressed="potKey"></iron-a11y-keys>
    <iron-a11y-keys target="[[target]]" keys="ctrl+4 ctrl+5 ctrl+6 ctrl+7" on-keys-pressed="foulKey"></iron-a11y-keys>
    <points-input on-shot="onShot"></points-input>
    <button on-click="onUndo">Undo</button>
    <button on-click="onRedo">Redo</button>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'frame-input',
    properties: {
      frame: Object,
      target: {
        type: Object,
        value: function() {
          return document.body;
        }
      }
    },
    missedKey: function(event) {
      this.frame.createShot({
        attempt: "pot",
        result: "nothing",
        points: 0
      });
    },
    potKey: function(event) {
      var points = parseInt(String.fromCharCode(event.detail.keyboardEvent.keyCode));
      this.frame.createShot({
        attempt: "pot",
        result: "pot",
        points: points
      });
    },
    foulKey: function(event) {
      var points = parseInt(String.fromCharCode(event.detail.keyboardEvent.keyCode));
      this.frame.createShot({
        attempt: "pot",
        result: "foul",
        points: points
      });
    },
    onShot: function(event) {
      var attrs = {
        attempt: "pot",
        result: "pot",
        points: event.detail
      };
      if (attrs.points == 0) {
        attrs.result = "nothing";
      }
      this.frame.createShot(attrs);
    },
    onUndo: function() {
      this.frame.undoShot();
    },
    onRedo: function() {
      this.frame.redoShot();
    }
  });
</script>
