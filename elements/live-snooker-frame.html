<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="frame-model.html">
<link rel="import" href="frame-score-view.html">
<link rel="import" href="input/frame-input.html">
<link rel="import" href="p2p-video.html">
<link rel="import" href="break-history-view.html">
<link rel="import" href="live-snooker-api.html">

<polymer-element name="live-snooker-frame">
  <template>
    <link rel="stylesheet" href="css/foundation.min.css">
    <style>
      #gameview {
        width: 640px;
      }

      #on-video-score {
        position: relative;
        top: -2em;
        text-align: center;
      }
    </style>
    <live-snooker-api id="api"></live-snooker-api>
    <frame-model model="{{model}}"></frame-model>
    <div id="logged"></div>
    <div class="row">
      <div class="large-8 columns">
        <div id="gameview">
          <p2p-video input="true"></p2p-video>
          <frame-score-view id="on-video-score" model="{{model}}"></frame-score-view>
        </div>
        <frame-input model="{{model}}"></frame-input>
      </div>
      <div class="large-4 columns">
        <break-history-view class="hidden-for-medium-down" breaks="{{model.attributes.shotGroups}}"></break-history-view>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      onAuthentication: function() {
        var _this = this;
        this.$.api.ajax('/account', {
          success: function(response) {
            user = response.user
            _this.$.logged.textContent = "Logged in as "
              + user.email + ". Last login: "
              + new Date(user.last_login).toLocaleString();
          }
        });
      },
      ready: function() {
        this.$.api.hookToAuth(this.onAuthentication.bind(this));
      }
    });
  </script>
</polymer-element>
