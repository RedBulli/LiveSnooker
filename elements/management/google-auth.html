<link rel="import" href="../../vendors/polymer/polymer.html">
<script src="https://apis.google.com/js/client:platform.js"></script>

<polymer-element name="google-auth" attributes="googleId onAuth">
  <template>
    <div id="gSignInWrapper">
      <div id="myButton" class="classesToStyleWith">
        Sign in with Google
      </div>
    </div>
  </template>

  <script>
    var signinCallback = function () {};

    Polymer({
      googleId: "",
      signinCallback: function(authResult) {
        if (authResult['status']['signed_in']) {
          this.$.myButton.setAttribute('style', 'display: none');
          this.onAuth(authResult);
        } else {
          // Update the app to reflect a signed out user
          // Possible error values:
          //   "user_signed_out" - User is signed-out
          //   "access_denied" - User denied access to your app
          //   "immediate_failed" - Could not automatically log in the user
          console.error('Sign-in state: ' + authResult['error']);
        }
      },
      ready: function() {
        signinCallback = this.signinCallback.bind(this);
        var additionalParams = {
          'theme' : 'dark',
          'clientid': this.googleId,
          'cookiepolicy': "single_host_origin",
          'callback': 'signinCallback',
          'scope': "https://www.googleapis.com/auth/plus.login"
        };
        gapi.signin.render(this.$.myButton, additionalParams);
      }
    });
  </script>
</polymer-element>
