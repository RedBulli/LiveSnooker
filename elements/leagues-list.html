<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="js/leagues.html">
<link rel="import" href="new-league-form.html">
<link rel="import" href="uikit.html">
<link rel="import" href="backbone-collection-renderer.html">
<link rel="import" href="../vendors/iron-signals/iron-signals.html">

<dom-module id="leagues-list">
  <style>
    #content {
      margin-left: 1em;
    }
  </style>

  <template>
    <iron-signals on-iron-signal-account="accountSignal"></iron-signals>
    <livesnooker-api id="api"></livesnooker-api>
    <div id="content">
      <template is="dom-if" if="[[leagues.length]]">
        <h2>Your leagues:</h2>
        <ul class="uk-list">
          <backbone-collection-renderer collection="[[leagues]]">
            <template class="content" is="dom-repeat">
              <li>
                <a href="[[ leagueUrl(item) ]]">[[item.attributes.name]]</a>
              </li>
            </template>
          </backbone-collection-renderer>
        </ul>
      </template>
      <template is="dom-if" if="[[!leagues.length]]">
        You don't admin or belong to any league.
      </template>
      <br>
      <template is="dom-if" if="[[user]]">
        <new-league-form leagues="{{leagues}}"></new-league-form>
      </template>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'leagues-list',
    properties: {
      leagues: Object,
      user: Object
    },
    leagueUrl: function(league) {
      return "/#/leagues/" + league.id + "/live/";
    },
    accountSignal: function(signal) {
      this.user = signal.detail;
    },
    ready: function() {
      var leagues = new Leagues();
      leagues.setApiClient(this.$.api);
      var _this = this;
      leagues.fetch({
        success: function() {
          _this.leagues = leagues;
        }
      });
    }
  });
</script>
