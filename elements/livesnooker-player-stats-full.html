<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="livesnooker-api.html">
<link rel="import" href="js/players.html">
<link rel="import" href="model-attribute.html">

<dom-module id="livesnooker-player-stats-full">
  <template>
    <livesnooker-api id="api"></livesnooker-api>
    <template is="dom-if" if="[[player]]" restamp>
      <h1>Stats for <model-attribute model="[[player]]" attribute="name"></model-attribute></h1>
      <template is="dom-if" if="[[breaks]]">
        <span>[[breaks]]</span>
      </template>
    </template>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'livesnooker-player-stats-full',
    properties: {
      playerId: {
        type: String,
        observer: '_onPlayerIdChange'
      },
      leagueId: String,
      player: Object,
      breaks: String
    },
    _onPlayerIdChange: function() {
      if (this.playerId && this.leagueId) {
        _this = this;
        this.$.api.findOrFetchModel(Player, {id: this.playerId, LeagueId: this.leagueId}).then(function(player)Â {
          _this.player = player;
          _this.fetchBreaks();
        });
      }
    },
    fetchBreaks: function() {
      var _this = this;
      this.$.api.ajaxPromise(this.player.url() + '/stats/full').then(function(breaks) {
        _this.breaks = JSON.stringify(breaks);
      });
    }
  });
</script>
