<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="js/frames.html">
<link rel="import" href="livesnooker-api.html">

<dom-module id="new-frame-form">
  <template>
    <livesnooker-api id="api"></livesnooker-api>
    <form class="uk-form">
      <legend>New frame</legend>
      <select id="player1" name="player1">
        <template id="playerOptions" is="dom-repeat" items="[[league.attributes.Players.models]]">
          <option value$="[[ item.id ]]">[[item.attributes.name]]</option>
        </template>
      </select>
      vs. 
      <select id="player2" name="player2">
        <template id="playerOptions" is="dom-repeat" items="[[league.attributes.Players.models]]">
          <option value$="[[ item.id ]]">[[item.attributes.name]]</option>
        </template>
      </select>

      <button class="uk-button uk-button-primary" on-click="createButtonClick">Create</button>
    </form>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'new-frame-form',
    properties: {
      league: Object
    },
    createButtonClick: function(event) {
      event.preventDefault();
      var p1 = this.league.get('Players').get(this.$.player1.value);
      var p2 = this.league.get('Players').get(this.$.player2.value);
      var frame = new Frame({
        League: this.league,
        Player1: p1,
        Player2: p2
      });
      frame.setApiClient(this.$.api);
      frame.save(frame.attributes, {
        success: function() {
          window.open("/frame.html?frameId=" + frame.id + "&input=true", "", "width=1050, height=600");
          frame.trigger("saved", frame);
        }
      });
    }
  });
</script>
