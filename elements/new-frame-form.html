<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="js/frame.html">
<link rel="import" href="live-snooker-api.html">

<polymer-element name="new-frame-form" attributes="league">
  <template>
    <live-snooker-api id="api"></live-snooker-api>
    <form>
      <select id="player1" name="player1">
        <!-- <option disabled selected> -- select player -- </option> -->
        <template id="playerOptions" repeat="{{ player in league.attributes.Players.models }}">
          <option value="{{ player.id }}">{{player.attributes.name}}</option>
        </template>
      </select>

      <select id="player2" name="player2">
        <!-- <option disabled selected> -- select player -- </option> -->
        <template repeat="{{ player in league.attributes.Players.models }}" ref="playerOptions"></template>
      </select>

      <button on-click="{{ createButtonClick }}">Create</button>
    </form>
  </template>
  <script>
    Polymer({
      createButtonClick: function(event) {
        event.preventDefault();
        var p1 = this.league.get('Players').get(this.$.player1.value);
        var p2 = this.league.get('Players').get(this.$.player2.value);
        var frame = new Frame({
          League: this.league,
          Player1: p1,
          Player2: p2
        });
        frame.setApiClient(this.$.api);
        var _this = this;
        frame.save(frame.attributes, {
          success: function() {
            window.open("/frame.html?frameId=" + frame.id, "", "width=800, height=600");
            _this.trigger("newFrame", frame);
          }
        });
      }
    });
  </script>
</polymer-element>
