<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="js/frame.html">
<link rel="import" href="live-snooker-api.html">

<dom-module id="new-frame-form">
  <template>
    <live-snooker-api id="api"></live-snooker-api>
    <form>
      <select id="player1" name="player1">
        <template id="playerOptions" is="dom-repeat" items="{{league.attributes.Players.models}}">
          <option value$="{{ item.id }}">{{item.attributes.name}}</option>
        </template>
      </select>

      <select id="player2" name="player2">
        <template id="playerOptions" is="dom-repeat" items="{{league.attributes.Players.models}}">
          <option value$="{{ item.id }}">{{item.attributes.name}}</option>
        </template>
      </select>

      <button on-click="createButtonClick">Create</button>
    </form>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'new-frame-form',
    properties: {
      league: Object
    },
    createButtonClick: function(event) {
      event.preventDefault();
      var p1 = this.league.get('Players').get(this.$.player1.value);
      var p2 = this.league.get('Players').get(this.$.player2.value);
      var frame = new Frame({
        League: this.league,
        Player1: p1,
        Player2: p2
      });
      frame.setApiClient(this.$.api);
      var _this = this;
      frame.save(frame.attributes, {
        success: function() {
          window.open("/frame.html?frameId=" + frame.id + "&input=true&video=true", "", "width=1050, height=600");
          _this.fire("new-frame", frame);
        }
      });
    }
  });
</script>
