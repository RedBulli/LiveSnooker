<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="../vendors/paper-menu/paper-menu.html">
<link rel="import" href="../vendors/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../vendors/paper-item/paper-item.html">
<link rel="import" href="../vendors/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../vendors/iron-icons/iron-icons.html">
<link rel="import" href="../vendors/iron-signals/iron-signals.html">
<link rel="import" href="../vendors/iron-dropdown/iron-dropdown.html">

<dom-module name="livesnooker-toolbar">
  <template>
    <iron-signals on-iron-signal-league="leagueSignal" on-iron-signal-account="accountSignal"></iron-signals>
    <live-snooker-api user="{{user}}"></live-snooker-api>
    <paper-toolbar>
      <paper-icon-button icon="menu" on-click="toggle" class="dropdown-trigger"></paper-icon-button>
      <iron-dropdown id="dropdown" horizontal-align="left" vertical-align="top" on-click="onDropdownClick">
        <paper-menu class="dropdown-content">
          <a href="/#!/">
            <paper-item horizontal center layout label="Home">
              Home
            </paper-item>
          </a>
          <template is="dom-if" if="{{league}}">
            <a href="{{ computeLeagueControlUrl(league) }}">
              <paper-item horizontal center layout label="Control league">
                Control league
              </paper-item>
            </a>
          </template>
          <a href="/#!/leagues/">
            <paper-item horizontal center layout label="Change league">
              Change league
            </paper-item>
          </a>
        </paper-menu>
      </iron-dropdown>
      <template is="dom-if" if="{{user}}">
        <a href="/#!/users/me"><paper-icon-button icon="face" title="{{user.email}}"></paper-icon-button></a>
      </template>
      <div flex>{{league.attributes.name}}</div>
    </paper-toolbar>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'livesnooker-toolbar',
    properties: {
      user: Object,
      league: Object
    },
    computeLeagueControlUrl: function(league) {
      return MoreRouting.urlFor('league', {leagueId: league.id});
    },
    toggle: function(event) {
      this.$.dropdown.positionTarget = event.target;
      this.$.dropdown.toggle();
    },
    leagueSignal: function(signal) {
      this.league = signal.detail;
    },
    accountSignal: function(signal) {
      this.user = signal.detail;
    },
    onDropdownClick: function() {
      this.$.dropdown.toggle();
    }
  });
</script>
