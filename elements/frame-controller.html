<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="frame-score-view.html">
<link rel="import" href="input/frame-input.html">
<link rel="import" href="p2p-video.html">
<link rel="import" href="break-history-view.html">
<link rel="import" href="live-snooker-api.html">
<link rel="import" href="frame-novideo-view.html">

<polymer-element name="frame-controller" attributes="frame video">
  <template>
    <link rel="stylesheet" href="css/foundation.min.css">
    <style>
      #gameview {
        width: 640px;
      }

      #on-video-score {
        position: relative;
        top: -2em;
        text-align: center;
      }
    </style>
    <live-snooker-api id="api"></live-snooker-api>
    <div class="row">
      <div class="large-8 columns">
        <div id="gameview">
          <template if="{{video}}">
            <p2p-video input="true" leagueId="{{frame.attributes.League.id}}" frameId="{{frame.id}}"></p2p-video>
            <frame-score-view id="on-video-score" model="{{frame}}" state="{{frame.state}}"></frame-score-view>
          </template>
          <template if="{{!video}}">
            <frame-novideo-view model="{{frame}}" state="{{frame.state}}"></frame-novideo-view>
          </template>
        </div>
        <frame-input model="{{frame}}"></frame-input>
      </div>
      <div class="large-4 columns">
        <break-history-view class="hidden-for-medium-down" breaks="{{frame.attributes.shotGroups}}"></break-history-view>
      </div>
    </div>
    <button on-click="{{ endFrame }}">End frame</button>
  </template>
  <script>
    Polymer({
      endFrame: function(event) {
        event.preventDefault();
        if (winner == "tie") throw "Cannot end frame in a tie";
        var winner = this.frame.getLeader();
        var confirmationResult = window.confirm(winner.get('name') + " will win the frame. This cannot be undone. Are you sure?");
        if (confirmationResult) {
          this.frame.set("WinnerId", winner.id);
          this.frame.save({WinnerId: winner.id}, {
            patch: true,
            success: function() {
              window.close();
            }
          });
        }
      }
    });
  </script>
</polymer-element>
