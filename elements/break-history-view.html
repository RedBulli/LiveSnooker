<link rel="import" href="../vendors/polymer/polymer.html">

<dom-module id="break-points">
  <template>
    <template is="dom-if" if="{{shotGroupViewModel.pots}}">
      <span>{{shotGroupViewModel.player.attributes.name}}</span>: <span>{{shotGroupViewModel.points.points}}</span>
    </template>
    <template is="dom-if" if="{{!shotGroupViewModel.pots}}">
      No pots for <span>{{shotGroupViewModel.shots}}</span> shots
    </template>
  </template>
</dom-module>

<script>
  Polymer({
    is: "break-points",
    properties: {
      shotGroup: {
        type: Object,
        observer: '_onShotGroupChange'
      },
      shotGroupViewModel: Array
    },
    updateView: function() {
      this.shotGroupViewModel = this.shotGroup.totals();
    },
    _onShotGroupChange: function() {
      this.shotGroup.get('shots').on('add remove change update', this.updateView.bind(this));
      this.updateView();
    }
  });
</script>


<dom-module id="break-history-view">
  <template>
    <ol>
      <template id="breaks" is="dom-repeat" items="{{breakModels}}" filter="isEngineer">
        <li>
          <break-points shot-group="{{item}}"></break-points>
        </li>
      </template>
    </ol>
  </template>
</dom-module>

<script>
  Polymer({
    is: "break-history-view",
    properties: {
      breaks: {
        type: Object,
        observer: '_onBreaksChange'
      },
      breakModels: Array
    },
    isEngineer: function(item) {
      return true;
    },
    _onBreaksChange: function() {
      if (this.breakModels) {
        this.splice('breakModels', 0, this.breaks.length);
      }
      this.breakModels = _.clone(this.breaks.models);
      this.breaks.on('add remove change update', (function(model) {
        this.splice('breakModels', 0, this.breakModels.length);
        this.breaks.each((function(breakModel) {
          this.push('breakModels', breakModel);
        }).bind(this));
      }).bind(this));
    },
  });
</script>
