<link rel="import" href="../vendors/polymer/polymer.html">

<dom-module id="break-points">
  <template>
    <template is="dom-if" if="{{shotGroupViewModel.pots}}">
      <span>{{shotGroupViewModel.player.attributes.name}}</span>: <span>{{shotGroupViewModel.points.points}}</span>
    </template>
    <template is="dom-if" if="{{shotGroupViewModel.fouls}}">
      <span>{{shotGroupViewModel.player.attributes.name}}</span>: FOUL <span>{{shotGroupViewModel.points.fouls}}</span>
    </template>
    <template is="dom-if" if="{{shotGroupViewModel.misses}}">
      No pots for <span>{{shotGroupViewModel.shots}}</span> shots
    </template>
  </template>
</dom-module>

<script>
  Polymer({
    is: "break-points",
    properties: {
      shotGroup: {
        type: Object
      },
      shotGroupViewModel: Object
    },
    ready: function() {
      this.shotGroup.get('shots').on('add remove', this.updateView.bind(this));
      this.updateView();
    },
    updateView: function() {
      if (this.shotGroup.get('shots').length > 0) {
        this.shotGroupViewModel = this.shotGroup.totals();
      }
    }
  });
</script>

<dom-module id="break-history-view">
  <template>
    <ul>
      <template id="breaks" is="dom-repeat" items="{{breakModels}}">
        <li>
          <break-points shot-group="{{item}}"></break-points>
        </li>
      </template>
    </ul>
  </template>
</dom-module>

<script>
  Polymer({
    is: "break-history-view",
    properties: {
      breaks: {
        type: Object,
        observer: '_onBreaksChange'
      },
      breakModels: Array
    },
    _renderBreaks: function() {
      this.splice('breakModels', 0, this.breakModels.length);
      this.breaks.each((function(breakModel) {
        this.unshift('breakModels', breakModel);
      }).bind(this));
    },
    _onBreaksChange: function() {
      if (this.breakModels) {
        this.splice('breakModels', 0, this.breaks.length);
      }
      this.breakModels = _.clone(this.breaks.models);
      this.breaks.on('add remove change update', (function() {
        this._renderBreaks();
      }).bind(this));
      this._renderBreaks();
    },
  });
</script>
