<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="uikit.html">
<link rel="import" href="livesnooker-api.html">
<link rel="import" href="livesnooker-home.html">
<link rel="import" href="../vendors/iron-pages/iron-pages.html">
<link rel="import" href="league-controller.html">
<link rel="import" href="leagues-list.html">
<link rel="import" href="livesnooker-toolbar.html">
<link rel="import" href="../vendors/google-signin/google-signin.html">
<link rel="import" href="../vendors/excess-router/excess-router.html">

<dom-module id="livesnooker-router">
  <template>
    <livesnooker-api id="api" host="{{backendHost}}"></livesnooker-api>
    <google-signin client-id="{{googleClientId}}" signed-in="{{signedIn}}" hidden$="{{signedIn}}" on-google-signin-success="onSignedIn"></google-signin>
    <a id="noauth" on-click="noAuthClicked">Use anonymously</a>
    <header>
      <livesnooker-toolbar></livesnooker-toolbar>
    </header>
    <excess-route route="/:mainmenu/(.*)" mainmenu="{{appMenu}}"></excess-route>
    <excess-route route="/" redirect-to="/leagues/"></excess-route>
    <iron-pages attr-for-selected="route" selected="[[appMenu]]">
      <section route="live">
        <excess-route route="/live/:leagueId" league-id="{{leagueId}}"></excess-route>
        <livesnooker-home league-id="{{leagueId}}" socket-url="[[socketUrl]]"></livesnooker-home>
      </section>
      <section route="leagues">
        <excess-route route="/leagues/:leagueId" league-id="{{leagueId}}" active="{{hasLeagueId}}"></excess-route>
        <template is="dom-if" if="{{!hasLeagueId}}">
          <leagues-list></leagues-list>
        </template>
        <template is="dom-if" if="{{hasLeagueId}}">
          <league-controller league-id="{{leagueId}}"></league-controller>
        </template>
      </section>
      <section route="404">Not found</section>
    </iron-pages>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'livesnooker-router',
    properties: {
      signedIn: Boolean,
      backendHost: String,
      googleClientId: String,
      socketUrl: String,
      route: Object
    },
    onSignedIn: function() {
      this.$.noauth.hidden = true;
      this.$.noauth.innerHTML = "Using anonymously";
    },
    noAuthClicked: function(event) {
      event.preventDefault();
      this.$.api.useAnonymously();
    }
  });
</script>
