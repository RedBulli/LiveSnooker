<link rel="import" href="../vendors/polymer/polymer.html">
<link rel="import" href="live-snooker-api.html">
<link rel="import" href="live-snooker-frame.html">
<link rel="import" href="js/frame.html">
<link rel="import" href="js/players.html">
<link rel="import" href="new-frame-form.html">
<link rel="import" href="js/league.html">

<polymer-element name="live-snooker" attributes="league">
  <template>
    <live-snooker-api id="api"></live-snooker-api>
    <template if="{{ league }}">
      <template id="frameTemplate" if="{{ frame }}">
        <live-snooker-frame frame="{{ frame }}"></live-snooker-frame>
      </template>
      <template if="{{ !frame }}">
        No Frame going try here: <br>
        <new-frame-form frame="{{ frame }}" league="{{league}}"></new-frame-form>
      </template>
    </template>
    <template id="noframe" if="{{ !league }}">
      {{ noframe }}
    </template>
  </template>
  <script>
    function routeToLeague(router) {
      if (localStorage.leagueId) router.go('/' + localStorage.leagueId);
      else router.go('/leagues/');
    }
    Polymer({
      domReady: function() {
        if (this.leagueId) localStorage.leagueId = this.leagueId;
        else {
          routeToLeague(this.router);
          return;
        }
        this.noframe = "Loading!";
        var _this = this;
        if (!this.league) {
          this.$.api.findOrFetchModel(League, this.leagueId)
            .then(function(league) {
              _this.league = league;
              _this.router.templateInstance.model.league = league;
            })
            .catch(function(model, response)Â {
              _this.noframe = response.responseJSON.error.message;
            });
        }
      }
    });
  </script>
</polymer-element>
