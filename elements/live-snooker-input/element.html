<link rel="import" href="/vendors/polymer/polymer.html">
<script src="/vendors/jquery/jquery.js"></script>

<polymer-element name="live-snooker-input" attributes="action_url">
  <template>
    <form method="POST" action="{{action_url}}" id="frameForm">
      <ul>
        <li>frame_id<input type="number" name="frame_id" value="2"></li>
        <li>player_id<input type="number" name="player_id" value="2"></li>
        <li>attempt<input type="text" name="attempt" value="pot"></li>
        <li>result<input type="text" name="result" value="pot"></li>
        <li>points<input type="number" name="points" value="2"></li>
      </ul> 
    </form>
  </template>
  
  <script>
    $.fn.serializeObject = function()
    {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    function listenForChanges() {
      console.log("listening");
      var _this = this;

      $(this.$.frameForm).find('input').change(function(event) {
        $.ajax({
          type: "POST",
          url: $(_this.$.frameForm).attr('action'),
          data: JSON.stringify($(_this.$.frameForm).serializeObject()),
          headers: {
            "Content-Type": "application/json"
          }
        });
      });
    }

    Polymer({
      domReady: listenForChanges,
      ready: function() {
      }
    });
  </script>
</polymer-element>
